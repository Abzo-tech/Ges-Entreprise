# üß™ Guide de Test Complet - Syst√®me de Pointage et Scanner QR

**Date**: $(date)  
**Objectif**: Tester et valider toutes les fonctionnalit√©s du syst√®me de pointage

---

## üöÄ Pr√©paration

### 1. Red√©marrer le Backend

```bash
cd /home/abzo/Downloads/ges-entreprises/backend
npm run dev
```

**Attendez le message** : `Server running on port 3000`

### 2. Rafra√Æchir le Frontend

Dans votre navigateur :

- Appuyez sur **Ctrl + Shift + R** (ou **Cmd + Shift + R** sur Mac)
- Ou ouvrez la console (F12) ‚Üí Clic droit sur rafra√Æchir ‚Üí "Vider le cache et actualiser"

### 3. Ouvrir la Console du Navigateur

- Appuyez sur **F12**
- Allez dans l'onglet **Console**
- Gardez-la ouverte pendant tous les tests

---

## üìã Tests √† Effectuer

### ‚úÖ Test 1: Scanner QR - Cam√©ra Unique

**Objectif**: V√©rifier qu'une seule cam√©ra s'affiche

**√âtapes**:

1. Connectez-vous √† l'application
2. S√©lectionnez une entreprise
3. Allez dans **"Pointages"**
4. Cliquez sur **"Scanner QR"**

**V√©rifications**:

- [ ] Une seule cam√©ra s'affiche
- [ ] Le cadre de scan est visible
- [ ] Pas d'erreur dans la console

**Logs attendus dans la console**:

```
üì∑ [QR SCANNER] Initialisation...
```

**Test suppl√©mentaire**: 5. Cliquez sur **"Fermer"** 6. Cliquez √† nouveau sur **"Scanner QR"**

**V√©rifications**:

- [ ] Toujours une seule cam√©ra
- [ ] Pas de cam√©ra fant√¥me
- [ ] Pas d'erreur de cleanup

---

### ‚úÖ Test 2: Formulaire de Pointage - Filtrage par Entreprise

**Objectif**: V√©rifier que seuls les employ√©s de l'entreprise s√©lectionn√©e sont affich√©s

**√âtapes**:

1. S√©lectionnez **Entreprise A** dans le header
2. Allez dans **"Pointages"**
3. Cliquez sur **"Nouveau Pointage"**
4. Ouvrez le dropdown **"Employ√©"**

**V√©rifications**:

- [ ] Seuls les employ√©s de l'Entreprise A sont list√©s
- [ ] Le nombre d'employ√©s correspond √† l'entreprise

**Logs attendus dans la console**:

```
GET /api/employes?entrepriseId=1 200
```

**Test suppl√©mentaire**: 5. Fermez le formulaire 6. S√©lectionnez **Entreprise B** dans le header 7. Cliquez sur **"Nouveau Pointage"** 8. Ouvrez le dropdown **"Employ√©"**

**V√©rifications**:

- [ ] Seuls les employ√©s de l'Entreprise B sont list√©s
- [ ] La liste a chang√© par rapport √† l'Entreprise A

---

### ‚úÖ Test 3: Scan QR - Check-in (Arriv√©e)

**Objectif**: V√©rifier que le scan QR enregistre correctement l'arriv√©e

**Pr√©requis**: Avoir un QR code d'employ√© (g√©n√©r√© depuis la page Employ√©s)

**√âtapes**:

1. Allez dans **"Pointages"**
2. Cliquez sur **"Scanner QR"**
3. Scannez le QR code d'un employ√© (ou utilisez un QR code de test)

**V√©rifications**:

- [ ] Le scanner se ferme automatiquement
- [ ] Un nouveau pointage appara√Æt dans la liste
- [ ] L'heure d'arriv√©e est enregistr√©e
- [ ] Le statut est "PRESENT"
- [ ] Pas d'erreur affich√©e

**Logs attendus dans la console**:

```
üì∑ [QR SCANNER] QR code d√©tect√©: {"type":"pointage","employeId":123,"timestamp":...}
‚úÖ [QR SCANNER] QR pars√© comme JSON: {...}
üöÄ [QR SCANNER] Envoi des donn√©es au parent: {...}
üì± [QR SCAN] QR Data re√ßu: {...}
üîµ [QR SCAN] Tentative de check-in...
‚úÖ [QR SCAN] Check-in r√©ussi: {...}
POST /api/pointages/qr/check-in 200
```

---

### ‚úÖ Test 4: Scan QR - Check-out (D√©part)

**Objectif**: V√©rifier que le scan QR enregistre correctement le d√©part

**Pr√©requis**: Avoir un employ√© d√©j√† point√© en arriv√©e (Test 3)

**√âtapes**:

1. Allez dans **"Pointages"**
2. Cliquez sur **"Scanner QR"**
3. Scannez le QR code du m√™me employ√©

**V√©rifications**:

- [ ] Le scanner se ferme automatiquement
- [ ] Le pointage est mis √† jour
- [ ] L'heure de d√©part est enregistr√©e
- [ ] Les heures travaill√©es sont calcul√©es
- [ ] Pas d'erreur affich√©e

**Logs attendus dans la console**:

```
üì∑ [QR SCANNER] QR code d√©tect√©: {...}
üì± [QR SCAN] QR Data re√ßu: {...}
üîµ [QR SCAN] Tentative de check-in...
‚ö†Ô∏è [QR SCAN] Check-in √©chou√©: Pointage d√©j√† commenc√© pour aujourd'hui
üîµ [QR SCAN] Tentative de check-out...
‚úÖ [QR SCAN] Check-out r√©ussi: {...}
POST /api/pointages/qr/check-out 200
```

---

### ‚úÖ Test 5: Scan QR - QR Code Simple (ID uniquement)

**Objectif**: V√©rifier la compatibilit√© avec les anciens QR codes (juste un ID)

**√âtapes**:

1. Cr√©ez un QR code contenant juste un nombre (ex: "123")
2. Allez dans **"Pointages"**
3. Cliquez sur **"Scanner QR"**
4. Scannez ce QR code simple

**V√©rifications**:

- [ ] Le QR code est accept√©
- [ ] Il est converti au format JSON automatiquement
- [ ] Le pointage est cr√©√© correctement

**Logs attendus dans la console**:

```
üì∑ [QR SCANNER] QR code d√©tect√©: 123
‚ö†Ô∏è [QR SCANNER] Pas du JSON, tentative de parsing comme ID
‚úÖ [QR SCANNER] QR converti en format standard: {"type":"pointage","employeId":123,"timestamp":...}
üöÄ [QR SCANNER] Envoi des donn√©es au parent: {...}
```

---

### ‚úÖ Test 6: Cr√©ation Manuelle de Pointage

**Objectif**: V√©rifier que la cr√©ation manuelle fonctionne

**√âtapes**:

1. Allez dans **"Pointages"**
2. Cliquez sur **"Nouveau Pointage"**
3. Remplissez le formulaire :
   - Employ√©: S√©lectionner un employ√©
   - Date: Aujourd'hui
   - Heure d'arriv√©e: 08:00
   - Heure de d√©part: 17:00
   - Pause d√©but: 12:00
   - Pause fin: 13:00
   - Statut: Pr√©sent
4. Cliquez sur **"Cr√©er"**

**V√©rifications**:

- [ ] Le formulaire se ferme
- [ ] Le pointage appara√Æt dans la liste
- [ ] Les heures travaill√©es = 8h (9h - 1h de pause)
- [ ] Les heures suppl√©mentaires = 0h

**Logs attendus dans la console**:

```
POST /api/pointages 201
```

---

### ‚úÖ Test 7: Calcul des Heures Suppl√©mentaires

**Objectif**: V√©rifier que les heures sup sont calcul√©es correctement

**√âtapes**:

1. Cr√©ez un pointage avec :
   - Arriv√©e: 08:00
   - D√©part: 19:00 (11h de travail)
   - Pause: 12:00 - 13:00 (1h)
   - Total: 10h de travail

**V√©rifications**:

- [ ] Heures travaill√©es = 8h
- [ ] Heures suppl√©mentaires = 2h
- [ ] Le calcul est affich√© correctement

---

### ‚úÖ Test 8: Modification de Pointage

**Objectif**: V√©rifier que la modification fonctionne

**√âtapes**:

1. Cliquez sur l'ic√¥ne **"Modifier"** d'un pointage existant
2. Changez l'heure d'arriv√©e de 08:00 √† 09:00
3. Cliquez sur **"Modifier"**

**V√©rifications**:

- [ ] Le formulaire se ferme
- [ ] Les modifications sont appliqu√©es
- [ ] Les heures travaill√©es sont recalcul√©es

**Logs attendus dans la console**:

```
PUT /api/pointages/{id} 200
```

---

### ‚úÖ Test 9: Gestion des Erreurs - QR Code Invalide

**Objectif**: V√©rifier que les erreurs sont bien g√©r√©es

**√âtapes**:

1. Cr√©ez un QR code avec du texte invalide (ex: "abc123xyz")
2. Scannez ce QR code

**V√©rifications**:

- [ ] Un message d'erreur s'affiche
- [ ] Le message est clair : "QR code invalide pour le pointage"
- [ ] Le scanner reste ouvert pour r√©essayer

**Logs attendus dans la console**:

```
üì∑ [QR SCANNER] QR code d√©tect√©: abc123xyz
‚ö†Ô∏è [QR SCANNER] Pas du JSON, tentative de parsing comme ID
‚ùå [QR SCANNER] Impossible de parser comme ID: abc123xyz
```

---

### ‚úÖ Test 10: Gestion des Erreurs - Double Check-in

**Objectif**: V√©rifier qu'on ne peut pas pointer deux fois l'arriv√©e

**√âtapes**:

1. Scannez le QR code d'un employ√© d√©j√† point√© en arriv√©e
2. Essayez de scanner √† nouveau pour un check-in

**V√©rifications**:

- [ ] Un message d'erreur s'affiche
- [ ] Le message indique : "Pointage d√©j√† enregistr√© pour aujourd'hui"
- [ ] Le pointage n'est pas dupliqu√©

**Logs attendus dans la console**:

```
üîµ [QR SCAN] Tentative de check-in...
‚ö†Ô∏è [QR SCAN] Check-in √©chou√©: Pointage d√©j√† commenc√© pour aujourd'hui
üîµ [QR SCAN] Tentative de check-out...
‚úÖ [QR SCAN] Check-out r√©ussi
```

---

### ‚úÖ Test 11: Filtres de Pointage

**Objectif**: V√©rifier que les filtres fonctionnent

**√âtapes**:

1. Allez dans **"Pointages"**
2. Utilisez les filtres :
   - Employ√©: S√©lectionner un employ√© sp√©cifique
   - Statut: S√©lectionner "Pr√©sent"
   - Date d√©but: Aujourd'hui
   - Date fin: Aujourd'hui

**V√©rifications**:

- [ ] La liste est filtr√©e correctement
- [ ] Seuls les pointages correspondants sont affich√©s
- [ ] Les filtres sont r√©actifs

---

### ‚úÖ Test 12: Permissions Vigile (Si applicable)

**Objectif**: V√©rifier que les vigiles ne peuvent scanner que leurs employ√©s

**Pr√©requis**: Avoir un compte vigile

**√âtapes**:

1. Connectez-vous en tant que vigile
2. Essayez de scanner un employ√© de votre entreprise
3. Essayez de scanner un employ√© d'une autre entreprise

**V√©rifications**:

- [ ] Le scan de l'employ√© de son entreprise fonctionne
- [ ] Le scan d'un employ√© d'une autre entreprise √©choue
- [ ] Le message d'erreur est clair

---

## üìä R√©sum√© des Tests

### Checklist Globale

- [ ] Test 1: Scanner QR - Cam√©ra unique ‚úÖ
- [ ] Test 2: Formulaire filtr√© par entreprise ‚úÖ
- [ ] Test 3: Scan QR Check-in ‚úÖ
- [ ] Test 4: Scan QR Check-out ‚úÖ
- [ ] Test 5: QR Code simple (ID) ‚úÖ
- [ ] Test 6: Cr√©ation manuelle ‚úÖ
- [ ] Test 7: Heures suppl√©mentaires ‚úÖ
- [ ] Test 8: Modification ‚úÖ
- [ ] Test 9: Erreur QR invalide ‚úÖ
- [ ] Test 10: Erreur double check-in ‚úÖ
- [ ] Test 11: Filtres ‚úÖ
- [ ] Test 12: Permissions vigile ‚úÖ

---

## üêõ En Cas de Probl√®me

### Probl√®me: Double Cam√©ra

**Solution**:

1. Rafra√Æchir la page (Ctrl+Shift+R)
2. Vider le cache du navigateur
3. V√©rifier la console pour les erreurs

### Probl√®me: Employ√©s Non Filtr√©s

**Solution**:

1. V√©rifier qu'une entreprise est s√©lectionn√©e
2. V√©rifier la console : `GET /api/employes?entrepriseId=X`
3. Rafra√Æchir la page

### Probl√®me: QR Code Non Reconnu

**Solution**:

1. V√©rifier le format du QR code dans la console
2. V√©rifier que l'employeId existe
3. V√©rifier les logs du backend

### Probl√®me: Erreur 500/403

**Solution**:

1. Red√©marrer le backend
2. V√©rifier que vous √™tes connect√©
3. V√©rifier vos permissions

---

## üìù Rapport de Test

Apr√®s avoir effectu√© tous les tests, remplissez ce rapport :

### Tests R√©ussis: \_\_\_/12

### Tests √âchou√©s:

- [ ] Test X: Description du probl√®me

### Observations:

-
-
-

### Recommandations:

-
-
-

---

## üéâ Validation Finale

Si tous les tests passent :

- ‚úÖ Le syst√®me de pointage est fonctionnel
- ‚úÖ Le scanner QR fonctionne correctement
- ‚úÖ Les filtres et permissions sont op√©rationnels
- ‚úÖ La gestion des erreurs est robuste

**Le syst√®me est pr√™t pour la production !** üöÄ
